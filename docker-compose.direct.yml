version: "3.7"
services:

  mq:
    image: rabbitmq:3-alpine
    networks:
    - default

  producer:
    depends_on:
    - mq
    build:
      dockerfile: Dockerfile
      context: .
    networks:
    - default
    command:
    - /event-producer
    - --uri
    - amqp://guest:guest@mq:5672
    - --routing-key
    - hello-for-processor-a
    - --event-count
    - "3600"

  processor_a:
    depends_on:
    - mq
    build:
      dockerfile: Dockerfile
      context: .
    networks:
    - default
    command:
    - /event-processor
    - --consumer-uri
    - amqp://guest:guest@mq:5672
    - --consumer-queue-name
    - hello-for-processor-a
    - --producer-uri
    - amqp://guest:guest@mq:5672
    - --producer-routing-key
    - hello-for-processor-b

  processor_b:
    depends_on:
    - mq
    build:
      dockerfile: Dockerfile
      context: .
    networks:
    - default
    command:
    - /event-processor
    - --consumer-uri
    - amqp://guest:guest@mq:5672
    - --consumer-queue-name
    - hello-for-processor-b
    - --producer-uri
    - amqp://guest:guest@mq:5672
    - --producer-routing-key
    - hello-for-consumer

  consumer:
    depends_on:
    - mq
    build:
      dockerfile: Dockerfile
      context: .
    networks:
    - default
    command:
    - /event-consumer
    - --uri
    - amqp://guest:guest@mq:5672
    - --queue-name
    - hello-for-consumer
